{% extends 'base.html.twig' %}
{% block title %}Edit Annonces{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    .page-bg{min-height:100vh;background:linear-gradient(120deg,#6ea8fe,#c29ffa,#f7a9a8,#ffd08a);background-size:300% 300%;animation:bgShift 16s ease infinite}
    @keyframes bgShift{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
    .glass{backdrop-filter:blur(12px);background:rgba(255,255,255,.16);border:1px solid rgba(255,255,255,.28);box-shadow:0 22px 44px rgba(0,0,0,.18);border-radius:1.2rem;overflow:hidden}
    .card-hero{padding:1.3rem 1.5rem;background:radial-gradient(60% 120% at 10% 0%,rgba(255,255,255,.35),rgba(255,255,255,.08))}
    .brand-badge{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;font-weight:700;background:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.6)}
    .thumb-lg{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:.8rem;border:1px solid rgba(0,0,0,.06);background:#f8f9fa}
    .toolbar a, .toolbar form button{border-radius:.8rem}
  </style>
{% endblock %}

{% block body %}
  <div class="page-bg py-5">
    <div class="container" style="max-width: 1100px;">

      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4 text-white">
        <div>
          <h1 class="h3 mb-0">Modifier l’annonce</h1>
          <div class="text-white-50 small">Mettez à jour le titre, la description, le prix et la photo</div>
        </div>
        <div class="toolbar d-flex gap-2">
          <a href="{{ path('app_annonces_index') }}" class="btn btn-light">← Retour à la liste</a>
          {# Le delete reste géré par ton include ; on le stylise juste après pour paraître bouton #}
          <div>
            {{ include('annonces/_delete_form.html.twig') }}
          </div>
        </div>
      </div>

      <div class="glass">
        <div class="card-hero d-flex align-items-center justify-content-between">
          <div>
            <h2 class="h5 mb-0">Édition</h2>
            <div class="text-muted small">Enregistrez pour appliquer les modifications</div>
          </div>
          <div class="brand-badge">✦</div>
        </div>

        <div class="p-4 p-lg-5">
          <div class="row g-4">
            <div class="col-12 col-lg-7">
              {# On conserve exactement ta logique pour le formulaire #}
              {{ include('annonces/_form.html.twig', {'button_label': 'Update'}) }}
            </div>

            <div class="col-12 col-lg-5">
              <div class="mb-2 text-muted small">Aperçu actuel</div>
              {% if annonce.imageName %}
                <img
                  class="thumb-lg"
                  src="{{ asset('uploads/annonces/' ~ annonce.imageName) }}"
                  alt="Photo de {{ annonce.titre }}"
                  onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,{{ '<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22><rect width=%22400%22 height=%22300%22 rx=%2212%22 fill=%22%23e9ecef%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2216%22 fill=%22%236c757d%22>no image</text></svg>'|e('url') }}';"
                >
              {% else %}
                <img
                  class="thumb-lg"
                  src="data:image/svg+xml;utf8,{{ '<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22><rect width=%22400%22 height=%22300%22 rx=%2212%22 fill=%22%23e9ecef%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2216%22 fill=%22%236c757d%22>aucune image</text></svg>'|e('url') }}"
                  alt="Aucune image"
                >
              {% endif %}
              <p class="text-muted mt-2 mb-0 small">
                Chargez une nouvelle image dans le formulaire pour la remplacer.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-3">
        <a href="{{ path('app_annonces_index') }}" class="btn btn-outline-light">← Retour</a>
      </div>
    </div>
  </div>

  <script>
    // Rend le bouton du delete form plus "bouton"
    (function(){
      const delForm = document.querySelector('form[action*="_delete"]') || document.querySelector('form[method="post"] button[name="_token"]')?.closest('form');
      if(delForm){
        const btn = delForm.querySelector('button, input[type="submit"]');
        if(btn){
          btn.classList.add('btn','btn-danger');
          btn.textContent = btn.textContent?.trim() || 'Supprimer';
        }
      }
    })();
  </script>
{% endblock %}
