{% extends 'base.html.twig' %}
{% block title %}Log in!{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    .auth-bg{
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;
      background:linear-gradient(120deg,#6ea8fe,#c29ffa,#f7a9a8,#ffd08a);background-size:300% 300%;
      animation:bgShift 16s ease infinite;
    }
    @keyframes bgShift{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
    .glass{
      width:100%;max-width:540px;border-radius:1.25rem;overflow:hidden;
      backdrop-filter:blur(12px);background:rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.28);box-shadow:0 22px 44px rgba(0,0,0,.18);
    }
    .card-hero{padding:1.35rem 1.5rem;background:radial-gradient(60% 120% at 10% 0%,rgba(255,255,255,.35),rgba(255,255,255,.08))}
    .brand-badge{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;font-weight:700;
      background:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.6)}
    .btn-glow{
      border:0;color:#fff;background:linear-gradient(135deg,#6f7afe,#b36bff);
      padding:.9rem 1.1rem;border-radius:.9rem;box-shadow:0 12px 24px rgba(111,122,254,.35);
      transition:transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }
    .btn-glow:hover{transform:translateY(-2px);filter:brightness(1.05);box-shadow:0 16px 28px rgba(111,122,254,.45)}
    .pw-wrap{position:relative}
    .pw-toggle{position:absolute;right:.6rem;top:50%;transform:translateY(-50%);border:0;background:transparent;opacity:.75;cursor:pointer}
    .pw-toggle:hover{opacity:1}
    .hint{font-size:.85rem;opacity:.85}
  </style>
{% endblock %}

{% block body %}


  <div class="auth-bg">
    <form method="post" class="glass" novalidate>
      <div class="card-hero d-flex align-items-center justify-content-between">
        <div>
          <h1 class="h4 mb-1">Welcome back</h1>
          <div class="text-muted small">Connectez-vous pour continuer</div>
        </div>
        <div class="brand-badge">‚ú¶</div>
      </div>

      <div class="p-4 p-lg-5">

        {# erreurs d'auth #}
        {% if error %}
          <div class="alert alert-danger mb-4">
            {{ error.messageKey|trans(error.messageData, 'security') }}
          </div>
        {% endif %}

        {# d√©j√† connect√© #}
        {% if app.user %}
          <div class="alert alert-info d-flex justify-content-between align-items-center mb-4">
            <span>Connect√© en tant que <strong>{{ app.user.userIdentifier }}</strong></span>
            <a class="btn btn-sm btn-outline-primary" href="{{ path('app_logout') }}">Logout</a>
          </div>
        {% endif %}

        <h2 class="h5 mb-4 text-center">Please sign in</h2>

        {# Email #}
        <div class="form-floating mb-3">
          <input type="email"
                 value="{{ last_username }}"
                 name="email" id="inputEmail"
                 class="form-control"
                 placeholder="name@example.com"
                 autocomplete="email" required autofocus>
          <label for="inputEmail">Email</label>
        </div>

        {# Password + toggle ≈ìil #}
        <div class="mb-2">
          <div class="form-floating pw-wrap">
            <input type="password"
                   name="password" id="inputPassword"
                   class="form-control"
                   placeholder="Password"
                   autocomplete="current-password" required>
            <label for="inputPassword">Password</label>
            <button type="button" class="pw-toggle" aria-label="Afficher/masquer le mot de passe" data-login-pw-toggle>üëÅÔ∏è</button>
          </div>
          <div class="hint mt-2">Conseil : √©vitez de r√©utiliser votre mot de passe ailleurs.</div>
        </div>

        {# CSRF #}
        <input type="hidden" name="_csrf_token" data-controller="csrf-protection" value="{{ csrf_token('authenticate') }}">

        {# Remember me #}
        <div class="form-check form-switch my-3">
          <input class="form-check-input" type="checkbox" id="rememberSwitch" name="_remember_me">
          <label class="form-check-label" for="rememberSwitch">Remember me</label>
        </div>

        <button class="btn btn-glow w-100" type="submit">Sign in</button>

        <div class="text-center mt-4 small">
          <span class="text-muted">Pas encore de compte ?</span>
          <a href="{{ path('app_register') }}" class="fw-semibold text-decoration-none">Cr√©er un compte</a>
        </div>

      </div>
    </form>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    // Toggle visibilit√© mot de passe
    (function(){
      const toggle = document.querySelector('[data-login-pw-toggle]');
      const input  = document.getElementById('inputPassword');
      if (toggle && input){
        toggle.addEventListener('click', () => {
          input.type = input.type === 'password' ? 'text' : 'password';
        });
      }
    })();
  </script>
{% endblock %}
